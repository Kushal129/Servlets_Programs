<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*,java.util.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Student Page</title>
</head>
<body>
    <h2>Welcome, Student!</h2>
    <h3>Available Books</h3>
    <table border="1">
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Action</th>
        </tr>
        <%
            Connection conn = null;
            Statement stmt = null;
            ResultSet rs = null;
            try {
                Class.forName("com.mysql.jdbc.Driver");
                conn = DriverManager.getConnection("jdbc:mysql://localhost/library", "username", "password");
                stmt = conn.createStatement();
                rs = stmt.executeQuery("SELECT * FROM books");
                while (rs.next()) {
                    int bookId = rs.getInt("id");
                    String title = rs.getString("title");
                    String author = rs.getString("author");
        %>
        <tr>
            <td><%= bookId %></td>
            <td><%= title %></td>
            <td><%= author %></td>
            <td><a href="IssueBook.jsp?bookId=<%= bookId %>">Issue</a></td>
        </tr>
        <%
                }
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                if (rs != null) rs.close();
                if (stmt != null) stmt.close();
                if (conn != null) conn.close();
            }
        %>
    </table>
</body>
</html>

---- issue book ----
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Issue Book</title>
</head>
<body>
    <h2>Issue Book</h2>
    <%
        int bookId = Integer.parseInt(request.getParameter("bookId"));
        int studentId = (int) session.getAttribute("userId");
        Connection conn = null;
        PreparedStatement stmt = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/library", "username", "password");
            stmt = conn.prepareStatement("INSERT INTO issued_books (book_id, student_id) VALUES (?, ?)");
            stmt.setInt(1, bookId);
            stmt.setInt(2, studentId);
            stmt.executeUpdate();
    %>
            <p>Book issued successfully!</p>
    <%
        } catch (Exception e) {
            e.printStackTrace();
    %>
            <p>Error issuing book!</p>
    <%
        } finally {
            if (stmt != null) stmt.close();
            if (conn != null) conn.close();
        }
    %>
    <a href="student.jsp">Back to Student Page</a>
</body>
</html>



------ employee ------

<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*,java.util.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Employee Page</title>
</head>
<body>
    <h2>Welcome, Employee!</h2>
    <h3>Add Book</h3>
    <form action="AddBook.jsp" method="post">
        Title: <input type="text" name="title"><br>
        Author: <input type="text" name="author"><br>
        <input type="submit" value="Add Book">
    </form>
    <h3>All Books</h3>
    <table border="1">
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Action</th>
        </tr>
        <%
            Connection conn = null;
            Statement stmt = null;
            ResultSet rs = null;
            try {
                Class.forName("com.mysql.jdbc.Driver");
                conn = DriverManager.getConnection("jdbc:mysql://localhost/library", "username", "password");
                stmt = conn.createStatement();
                rs = stmt.executeQuery("SELECT * FROM books");
                while (rs.next()) {
                    int bookId = rs.getInt("id");
                    String title = rs.getString("title");
                    String author = rs.getString("author");
        %>
        <tr>
            <td><%= bookId %></td>
            <td><%= title %></td>
            <td><%= author %></td>
            <td>
                <a href="EditBook.jsp?bookId=<%= bookId %>">Edit</a> | 
                <a href="DeleteBook.jsp?bookId=<%= bookId %>">Delete</a>
            </td>
        </tr>
        <%
                }
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                if (rs != null) rs.close();
                if (stmt != null) stmt.close();
                if (conn != null) conn.close();
            }
        %>
    </table>
</body>
</html>


----- (EditBook.jsp) ------
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Edit Book</title>
</head>
<body>
    <h2>Edit Book</h2>
    <%
        int bookId = Integer.parseInt(request.getParameter("bookId"));
        String title = "";
        String author = "";
        Connection conn = null;
        PreparedStatement stmt = null;
        ResultSet rs = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/library", "username", "password");
            stmt = conn.prepareStatement("SELECT * FROM books WHERE id=?");
            stmt.setInt(1, bookId);
            rs = stmt.executeQuery();
            if (rs.next()) {
                title = rs.getString("title");
                author = rs.getString("author");
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            if (rs != null) rs.close();
            if (stmt != null) stmt.close();
            if (conn != null) conn.close();
        }
    %>
    <form action="UpdateBook.jsp" method="post">
        Title: <input type="text" name="title" value="<%= title %>"><br>
        Author: <input type="text" name="author" value="<%= author %>"><br>
        <input type="hidden" name="bookId" value="<%= bookId %>">
        <input type="submit" value="Update Book">
    </form>
    <a href="employee.jsp">Back to Employee Page</a>
</body>
</html>


----- (UpdateBook.jsp) ----
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Update Book</title>
</head>
<body>
    <h2>Update Book</h2>
    <%
        int bookId = Integer.parseInt(request.getParameter("bookId"));
        String title = request.getParameter("title");
        String author = request.getParameter("author");
        Connection conn = null;
        PreparedStatement stmt = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/library", "username", "password");
            stmt = conn.prepareStatement("UPDATE books SET title=?, author=? WHERE id=?");
            stmt.setString(1, title);
            stmt.setString(2, author);
            stmt.setInt(3, bookId);
            stmt.executeUpdate();
    %>
            <p>Book updated successfully!</p>
    <%
        } catch (Exception e) {
            e.printStackTrace();
    %>
            <p>Error updating book!</p>
    <%
        } finally {
            if (stmt != null) stmt.close();
            if (conn != null) conn.close();
        }
    %>
    <a href="employee.jsp">Back to Employee Page</a>
</body>
</html>

---- (DeleteBook.jsp) ----

<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Delete Book</title>
</head>
<body>
    <h2>Delete Book</h2>
    <%
        int bookId = Integer.parseInt(request.getParameter("bookId"));
        Connection conn = null;
        PreparedStatement stmt = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/library", "username", "password");
            stmt = conn.prepareStatement("DELETE FROM books WHERE id=?");
            stmt.setInt(1, bookId);
            stmt.executeUpdate();
    %>
            <p>Book deleted successfully!</p>
    <%
        } catch (Exception e) {
            e.printStackTrace();
    %>
            <p>Error deleting book!</p>
    <%
        } finally {
            if (stmt != null) stmt.close();
            if (conn != null) conn.close();
        }
    %>
    <a href="employee.jsp">Back to Employee Page</a>
</body>
</html>
